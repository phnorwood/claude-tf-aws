# Static Website Deployment on AWS EC2

Infrastructure as Code (IaC) solution using Terraform and Ansible to deploy a static website on AWS EC2.

## Overview

- **Infrastructure**: AWS EC2 t2.micro instance (Ubuntu 22.04 LTS)
- **Region**: us-east-1
- **Web Server**: Nginx
- **Website Source**: https://github.com/phnorwood/claude-intro.git
- **IaC Tool**: HashiCorp Terraform
- **Configuration Management**: Red Hat Ansible

## Architecture

```
┌─────────────────────────────────────────┐
│          AWS Cloud (us-east-1)          │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │   Security Group                  │  │
│  │   - Port 22 (SSH)                 │  │
│  │   - Port 80 (HTTP)                │  │
│  │   - Port 443 (HTTPS)              │  │
│  └───────────────────────────────────┘  │
│                  │                      │
│  ┌───────────────▼───────────────────┐  │
│  │   EC2 Instance (t2.micro)         │  │
│  │   - Ubuntu 22.04 LTS              │  │
│  │   - Nginx Web Server              │  │
│  │   - Static Website Files          │  │
│  └───────────────────────────────────┘  │
│                  │                      │
│  ┌───────────────▼───────────────────┐  │
│  │   Elastic IP (Static)             │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

## Prerequisites

1. **AWS Credentials**: Configured via AWS CLI or environment variables
2. **Terraform**: Version >= 1.0
3. **Ansible**: Version >= 2.9
4. **Git**: For cloning repositories

## Project Structure

```
.
├── README.md
├── terraform/
│   ├── provider.tf          # AWS provider configuration
│   ├── variables.tf         # Input variables
│   ├── main.tf              # Main infrastructure resources
│   ├── outputs.tf           # Output values
│   └── inventory.tpl        # Ansible inventory template
└── ansible/
    ├── ansible.cfg          # Ansible configuration
    ├── inventory.ini        # Generated by Terraform
    ├── inventory.ini.example
    ├── playbook.yml         # Nginx configuration playbook
    └── ssh-key.pem          # Generated by Terraform
```

## Deployment Instructions

### Step 1: Initialize Terraform

```bash
cd terraform
terraform init
```

### Step 2: Review the Deployment Plan

```bash
terraform plan
```

### Step 3: Deploy Infrastructure

```bash
terraform apply
```

Type `yes` when prompted to confirm the deployment.

**Important Outputs:**
- `instance_public_ip`: Public IP address of your server
- `website_url`: Direct URL to access your website
- `ssh_connection`: SSH command to access the server

### Step 4: Run Ansible Playbook

After Terraform completes, configure the web server:

```bash
cd ../ansible
ansible-playbook playbook.yml
```

### Step 5: Access Your Website

Open your browser and navigate to the IP address shown in the Terraform outputs:

```
http://<instance_public_ip>
```

## Management Commands

### SSH into the Server

```bash
ssh -i ansible/ssh-key.pem ubuntu@<instance_public_ip>
```

### Update Website Content

To deploy new changes from the GitHub repository:

```bash
cd ansible
ansible-playbook playbook.yml
```

### Check Nginx Status

```bash
ssh -i ansible/ssh-key.pem ubuntu@<instance_public_ip>
sudo systemctl status nginx
```

### View Nginx Logs

```bash
ssh -i ansible/ssh-key.pem ubuntu@<instance_public_ip>
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

## Terraform Resources Created

- **EC2 Instance**: Ubuntu 22.04 LTS, t2.micro
- **Security Group**: Allows HTTP (80), HTTPS (443), and SSH (22)
- **Elastic IP**: Static public IP address
- **SSH Key Pair**: Automatically generated RSA 4096-bit key
- **AMI Data Source**: Latest Ubuntu 22.04 LTS AMI

## Ansible Playbook Tasks

1. Wait for instance to be SSH-accessible
2. Update system packages
3. Install Nginx and Git
4. Clone GitHub repository
5. Deploy static website files
6. Configure Nginx
7. Start and enable Nginx service

## Customization

### Change GitHub Repository

Edit [terraform/variables.tf](terraform/variables.tf):

```hcl
variable "github_repo" {
  default = "https://github.com/YOUR_USERNAME/YOUR_REPO.git"
}
```

### Change Instance Type

Edit [terraform/variables.tf](terraform/variables.tf):

```hcl
variable "instance_type" {
  default = "t3.small"  # or any other instance type
}
```

### Restrict SSH Access

Edit [terraform/variables.tf](terraform/variables.tf):

```hcl
variable "allowed_ssh_cidr" {
  default = ["YOUR_IP_ADDRESS/32"]
}
```

## Cleanup

To destroy all resources and avoid AWS charges:

```bash
cd terraform
terraform destroy
```

Type `yes` when prompted to confirm the destruction.

## Security Considerations

- SSH key is automatically generated and saved locally
- Keep `ssh-key.pem` secure and never commit it to version control
- Security group allows SSH from anywhere by default (customize for production)
- Elastic IP incurs charges when not attached to a running instance
- Consider using AWS Secrets Manager for sensitive data

## Troubleshooting

### Ansible Cannot Connect

1. Verify the instance is running: `terraform output instance_public_ip`
2. Check security group allows SSH from your IP
3. Wait 30-60 seconds after Terraform completes for instance to be fully ready
4. Verify SSH key permissions: `chmod 600 ansible/ssh-key.pem`

### Website Not Loading

1. Check Nginx status via SSH
2. Verify security group allows HTTP (port 80)
3. Check Nginx logs for errors
4. Ensure GitHub repository was cloned successfully

### Terraform Errors

1. Verify AWS credentials are configured
2. Check you have necessary IAM permissions
3. Ensure no resource limits are reached (Elastic IPs, instances)

## Cost Estimation

- **EC2 t2.micro**: Free tier eligible (750 hours/month for 12 months)
- **Elastic IP**: Free while attached to running instance
- **Data Transfer**: First 1 GB/month free, then $0.09/GB
- **Estimated Monthly Cost**: $0-$10 depending on usage

## License

This project is provided as-is for educational and demonstration purposes.

## Support

For issues or questions:
1. Check the Troubleshooting section
2. Review Terraform and Ansible documentation
3. Verify AWS service health status
